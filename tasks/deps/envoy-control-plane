#!/usr/bin/env bash

set -e -u -x
source ./tasks/helpers.sh

envoy_control_plane_version="1.3.0"
envoy_control_plane_hash="4f2fe25e0f5e3b6d7beaf69480e1a1882cb0c8a2e94ce649d1bce8b53fff2be3"
if [ "$TARGETARCH" == "arm64" ]; then
  envoy_control_plane_hash="01553e98c4abafd108fa77f70d5a79f41acf46f5ca590a6dd193170edc3eb12d"
fi

task_working_dir
download "https://github.com/GUI/envoy-control-plane/releases/download/v${envoy_control_plane_version}/envoy-control-plane-v${envoy_control_plane_version}-linux-${TARGETARCH}.tar.gz" "sha256" "$envoy_control_plane_hash"
extract_download "envoy-control-plane-v${envoy_control_plane_version}-linux-${TARGETARCH}.tar.gz"

install -D -m 755 "envoy-control-plane" "$STAGE_EMBEDDED_DIR/bin/envoy-control-plane"

stamp
