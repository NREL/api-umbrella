#!/usr/bin/env bash

set -e -u -x
source ./tasks/helpers.sh

glauth_version="2.1.0"
glauth_hash="4432260e6468644f99bfa61cc8a9586439823aada05a5602e7aacda765fd320d"
if [ "$TARGETARCH" == "arm64" ]; then
  glauth_hash="e25fccf3fe75f5638ad893ed34bbe0bfd18a3ac9539521110628c32f329dfe5d"
fi

task_working_dir
download "https://github.com/glauth/glauth/releases/download/v$glauth_version/linux${TARGETARCH}.zip" "sha256" "$glauth_hash"
rm -rf "_persist/downloads/linux${TARGETARCH}"
unzip "_persist/downloads/linux${TARGETARCH}.zip" -d "_persist/downloads/linux${TARGETARCH}"

install -D -m 755 "_persist/downloads/linux${TARGETARCH}/glauth" "$TEST_INSTALL_PREFIX/bin/glauth"

stamp
